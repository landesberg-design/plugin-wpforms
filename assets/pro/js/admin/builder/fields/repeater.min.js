var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.FieldRepeater=WPForms.Admin.Builder.FieldRepeater||function(e,s){const r=wpforms_builder.repeater;let o={};const d={},n={init(){s(n.ready)},ready(){n.setup(),n.hooks(),n.events()},setup(){o={$builder:s("#wpforms-builder")}},initFields(){o.$builder.find(".wpforms-field-repeater").each(function(){var e=s(this).data("field-id");n.adjustRowsAppearance(e)})},hooks(){wp.hooks.addFilter("wpforms.LayoutField.isFieldAllowedDragInColumn","wpforms/field-repeater",n.filterIsFieldAllowedDragInColumn),wp.hooks.addFilter("wpforms.LayoutField.isFieldAllowedInColumn","wpforms/field-repeater",n.filterIsFieldAllowedInColumn),wp.hooks.addFilter("wpforms.LayoutField.fieldMoveRejectedModalOptions","wpforms/field-repeater",n.filterFieldMoveRejectedModalOptions),wp.hooks.addFilter("wpforms.ConditionalLogicCore.BeforeRemoveUnsupportedFields","wpforms/field-repeater",n.removeRepeaterFieldsAndChildren)},events(){o.$builder.on("click",".wpforms-field-option-row-display input",n.handleDisplayClick).on("change",".wpforms-field-option-row-display input",n.handleDisplayChange).on("change",".wpforms-field-option-row-preset input",n.handlePresetChange).on("change",".wpforms-field-option-row-button-type select",n.handleButtonTypeChange).on("input",".wpforms-field-option-row-label input",n.handleFieldLabelChange).on("input",".wpforms-field-option-row-button-labels input",n.handleButtonLabelsChange).on("change",".wpforms-field-option-row-rows-limit input",n.handleRowsLimitChange).on("wpformsLayoutAfterPresetChange",n.handleAfterPresetChange).on("wpformsLayoutAfterHeightBalance",n.handleAfterHeightBalance).on("wpformsFieldAdd",n.handleFieldAdd).on("wpformsFieldDelete",n.handleFieldDelete).on("wpformsFieldMoveRejected",n.handleFieldMoveRejected).on("wpformsFieldDuplicated",n.handleFieldDuplicated).on("wpformsBuilderReady",n.initFields).on("wpformsFieldOptionTabToggle",n.handleFieldOptionTabToggle).on("wpformsFieldMove",n.handleFieldMove).on("change",".wpforms-field-option-layout .wpforms-field-option-row-conditional_logic input",n.handleUpdateFieldCLOption),s(e).on("resize",_.debounce(n.handleWindowResize,50))},handleDisplayClick(){var e=s(this);return"rows"!==e.val()||(e=e.closest(".wpforms-field-option-repeater").data("field-id"),!!WPForms.Admin.Builder.FieldLayout.getFieldColumnsData(e).every(e=>e?.fields?.length<=1))||(n.errorModal(r.not_allowed,r.cant_switch_to_rows_alert),!1)},handleDisplayChange(){var e=s(this),o=e.val(),e=e.closest(".wpforms-field-option-repeater"),l=e.data("field-id"),i=s("#wpforms-field-"+l),t=e.find(".wpforms-field-option-row-button-type select").val();e.find(".wpforms-field-option-row-button-type").toggleClass("wpforms-hidden","rows"===o),e.find(".wpforms-field-option-row-button-labels").toggleClass("wpforms-hidden","rows"===o||"icons"===t),i.find(".wpforms-field-layout-columns").toggleClass("wpforms-layout-display-rows","rows"===o).toggleClass("wpforms-layout-display-blocks","blocks"===o),"blocks"===o&&i.find(".wpforms-layout-column-placeholder").css("top",""),i.find(".wpforms-field-repeater-display-rows-buttons").toggleClass("wpforms-hidden","rows"!==o),i.find(".wpforms-field-repeater-display-blocks-buttons").toggleClass("wpforms-hidden","blocks"!==o),n.adjustRowsAppearance(l)},handlePresetChange(){var e=s(this),o=e.val();e.closest(".wpforms-field-option-repeater").find(".wpforms-field-option-row-size").toggleClass("wpforms-disabled","100"!==o)},handleAfterPresetChange(e,o){var l=s("#wpforms-field-"+o.fieldId),i=s(`#wpforms-field-option-row-${o.fieldId}-display input:checked`).val(),t=wp.template("wpforms-repeater-field-display-rows-buttons-template"),i="rows"===i?"":"wpforms-hidden";l.find(".wpforms-field-layout-columns").append(t({class:i})),n.adjustRowsAppearance(o.fieldId)},handleButtonTypeChange(){var e=s(this),o=e.val(),e=e.closest(".wpforms-field-option-repeater"),l=s("#wpforms-field-"+e.data("field-id"));e.find(".wpforms-field-option-row-button-labels").toggleClass("wpforms-hidden","icons"===o),l.find(".wpforms-field-repeater-display-blocks-buttons").attr("data-button-type",o)},handleFieldLabelChange(){var e=s(this).closest(".wpforms-field-option-repeater").data("field-id");n.adjustRowsAppearance(e)},handleWindowResize(){o.$builder.find(".wpforms-field-repeater").each(function(){n.adjustRowsAppearance(s(this).data("field-id"))})},handleButtonLabelsChange(){var e=s(this),o=e.closest(".wpforms-field-option-repeater").data("field-id"),o=s("#wpforms-field-"+o),l=e.val(),e=e.attr("class");o.find(`.wpforms-field-repeater-display-blocks-buttons-${e} span`).text(l)},handleRowsLimitChange(){var e=s(this);"rows-limit-min"===e.attr("class")?n.normalizeLimitMin(e):n.normalizeLimitMax(e),e.val(Math.round(e.val()))},normalizeLimitMin(e){var o=e.val(),l=parseInt(o,10)||0;""===o||l<1?e.val(1):(o=e.closest(".wpforms-field-option-row-rows-limit").find("input.rows-limit-max"),(o=parseInt(o.val(),10))<=l&&e.val(o-1))},normalizeLimitMax(e){var o=e.val(),l=e.closest(".wpforms-field-option-row-rows-limit").find("input.rows-limit-min"),l=parseInt(l.val(),10);""===o?e.val(l+(1===l?9:10)):(o=parseInt(o,10))<=l?e.val(l+1):o>r.rows_limit_max&&e.val(r.rows_limit_max)},handleAfterHeightBalance(e,o){o?.$rows&&(o=o.$rows.closest(".wpforms-field-repeater").data("field-id"))&&n.adjustRowsAppearance(o)},handleFieldAdd(e,o,l){o&&l&&0!==(l=s("#wpforms-field-"+o).closest(".wpforms-field-repeater")).length&&n.adjustRowsAppearance(l.data("field-id"))},handleFieldDelete(e,o,l,i){0!==i.length&&(i=i.closest(".wpforms-field-repeater"),n.adjustRowsAppearance(i.data("field-id")))},handleFieldMoveRejected(e,o){n.adjustRowsAppearance(o.closest(".wpforms-field-repeater").data("field-id"))},handleFieldDuplicated(e,o,l,i,t){"repeater"===l.data("field-type")&&(l=s(`#wpforms-field-option-${o} .wpforms-field-option-row-display input:checked`).val(),s(`#wpforms-field-option-${i}-display-`+l).prop("checked",!0),n.adjustRowsAppearance(i))},handleFieldOptionTabToggle(e,o){n.updateFieldCLOption(o),n.updateFieldCalculationOption(o),n.updateFieldGeolocationRequirementsAlerts(o),n.updateFieldSignatureRequirementsAlerts(o)},handleFieldMove(e,o){o=o.item.first().data("field-id");n.updateFieldCLOption(o),n.updateFieldCalculationOption(o),n.updateFieldGeolocationRequirementsAlerts(o),n.updateFieldSignatureRequirementsAlerts(o)},handleUpdateFieldCLOption(){var e=s(this).parents(".wpforms-field-option-row").data("field-id"),e=s("#wpforms-field-"+e);e.length&&e.find(".wpforms-field").each(function(){n.updateFieldCLOption(s(this).data("field-id"))})},updateFieldGeolocationRequirementsAlerts(o){var l=s("#wpforms-field-"+o);if(!(!l?.length||l.hasClass("wpforms-field-repeater")||n.isInsideRepeaterAddonAllowed("wpforms-geolocation")||"undefined"!=typeof wpforms_addons&&wpforms_addons["wpforms-geolocation"])){l=0<l.closest(".wpforms-field-repeater").length,o=s(`#wpforms-field-option-row-${o}-enable_address_autocomplete`);let e=o.siblings(".wpforms-alert-field-requirements");e.length||(e=s(wpforms_builder.repeater.addons_requirements_alert["wpforms-geolocation"]),o.before(e)),e.toggleClass("wpforms-hidden",!l)}},updateFieldSignatureRequirementsAlerts(o){var l=s("#wpforms-field-"+o);if(l?.length&&!l.hasClass("wpforms-field-repeater")&&!n.isInsideRepeaterAddonAllowed("wpforms-signatures")){l=0<l.closest(".wpforms-field-repeater").length,o=s(`.wpforms-field-option-signature #wpforms-field-option-row-${o}-label`);let e=o.siblings(".wpforms-alert-field-requirements");e.length||(e=s(wpforms_builder.repeater.addons_requirements_alert["wpforms-signatures"]),o.before(e)),e.toggleClass("wpforms-hidden",!l)}},isInsideRepeaterAddonAllowed(e){return wpforms_builder.repeater.addons_requirements[e]},updateFieldCalculationOption(o){var l=s("#wpforms-field-"+o);if(!(!l?.length||l.hasClass("wpforms-field-repeater")||"undefined"!=typeof wpforms_addons&&wpforms_addons["wpforms-calculations"])){var l=0<l.closest(".wpforms-field-repeater").length,o=s(`#wpforms-field-option-row-${o}-calculation_is_enabled`),i=o.find("input");let e=o.siblings(".wpforms-notice-field-calculation_is_enabled");e.length||(e=s(`<div class="wpforms-alert wpforms-alert-warning wpforms-notice-field-calculation_is_enabled" title="${r.calculation_notice_tooltip}">
						<p>${r.calculation_notice_text}</p>
					</div>`),o.before(e)),e.find("p").text(i.prop("checked")?r.calculation_notice_text_grp:r.calculation_notice_text),l&&i.prop("checked",!1).trigger("change"),o.toggleClass("wpforms-disabled",l),e.toggleClass("wpforms-hidden",!l)}},updateFieldCLOption(l){var i=s("#wpforms-field-"+l);if(i?.length&&!i.hasClass("wpforms-field-repeater")&&!i.hasClass("wpforms-field-layout")){var t=0<i.closest(".wpforms-field-repeater").length;let e=0<i.closest(".wpforms-field-layout").length;var l=s(`#wpforms-field-option-row-${l}-conditional_logic`),r=l.closest(".wpforms-conditional-block"),d=t?"repeater":"layout";e&&!n.isLayoutCLEnabled(i.closest(".wpforms-field-layout"))&&(e=!1);let o=r.siblings(".wpforms-notice-field-conditional_logic");o.length||(o=s(`<div class="wpforms-alert wpforms-alert-warning wpforms-notice-field-conditional_logic">
						<p>${wpforms_builder[d].cl_notice_text}</p>
					</div>`),r.before(o));i=l.find(".wpforms-toggle-control").find("input"),i=((t||e)&&i.prop("checked",!1),t||e||i.is(":checked")||(l=l.siblings(".wpforms-conditional-groups").length,i.prop("checked",l)),r.find(".wpforms-conditional-groups").length);o.find("p").text(i?wpforms_builder[d].cl_notice_text_grp:wpforms_builder[d].cl_notice_text),r.toggleClass("wpforms-disabled",t||e),o.toggleClass("wpforms-hidden",!t&&!e)}},isLayoutCLEnabled(e){e=e.data("field-id");return s(`#wpforms-field-option-row-${e}-conditional_logic`).find(".wpforms-toggle-control").find("input").is(":checked")},adjustRowsAppearance(e){var o=s("#wpforms-field-"+e+".wpforms-field-repeater");if(o.length){const r=s(`#wpforms-field-option-row-${e}-display input:checked`).val();e=o.find(".wpforms-layout-column");const d=o.find(".wpforms-field-repeater-display-rows-buttons");let i=0;e.each(function(){var e=s(this),o=e.find(".wpforms-field").first(),l=e.find(".wpforms-alert");e.toggleClass("hide-placeholder",(0<o.length||0<l.length)&&"rows"===r),(o.length||l.length)&&(e=o.find(".label-title").height()||0,e=0<l.length?l.height()/2-d.height()/2-4:e,i=e<i||0===i?e:i)});var l=o.find("> .label-title").outerHeight()||20,t=l+30,t=(o.find(".wpforms-field-layout-columns").css("margin-top","-"+t+"px").find(".wpforms-layout-column").css({"padding-top":t,"min-height":t+55}),0===e.find(".wpforms-field-drag-placeholder").length&&(t=o.find(".wpforms-layout-display-rows .wpforms-layout-column-placeholder"),l=0!==i?i+l+47:l+16,d.css("top",l),t.css("top",l+14)),o.find(".wpforms-layout-column.hide-placeholder"));o.find(".wpforms-field-layout-columns").toggleClass("hidden-placeholders",t.length===e.length)}},filterIsFieldAllowedDragInColumn(e,o,l){return d.fieldMoveToRowsRejected=!1,d.fieldTypeRejected=!e&&o,e&&l?.length&&l?.hasClass("wpforms-layout-column")&&(o=l?.closest(".wpforms-field-repeater"))?.length&&(o=o.data("field-id"),"rows"===s(`#wpforms-field-option-row-${o}-display input:checked`).val())&&l.find(".wpforms-field:not(.wpforms-field-dragging)").length?!(d.fieldMoveToRowsRejected=!0):e},filterFieldMoveRejectedModalOptions(e,o,l,i){if(!(i?.closest(".wpforms-field-repeater"))?.length)return e;var t,i={title:r.not_allowed,content:r.move_to_rows_rejected_alert,type:"orange"};if(d.fieldTypeRejected)t=s("#wpforms-add-fields-"+d.fieldTypeRejected).text(),i.content=r.not_allowed_alert_text.replace(/%s/g,`<strong>${t}</strong>`);else{if(!d.fieldMoveToRowsRejected)return e;i.content=r.move_to_rows_rejected_alert}return i},removeRepeaterFieldsAndChildren(e){if(!e)return{};for(const l in e)if("repeater"===e[l].type){var o=e[l]["columns-json"];if(delete e[l],o.length)for(const i of o)if(i.fields?.length)for(const t of i.fields)delete e[t]}return e},errorModal(e,o){s.confirm({title:e,content:o,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},isFieldAllowedInColum(e){return r.not_allowed_fields.indexOf(e)<0},filterIsFieldAllowedInColumn(e,o,l){return e&&l?.length&&l?.hasClass("wpforms-layout-column")&&(l?.closest(".wpforms-field-repeater"))?.length?n.isFieldAllowedInColum(o):e}};return n}((document,window),jQuery),WPForms.Admin.Builder.FieldRepeater.init();